{% extends "incs/base.html" %}
{% block title %} Account - Laundry And Fashion {% endblock title %}

{% block content %}

{% include 'incs/modals/add_address_modal.html' %}
   <!-- Page content -->
<main class="content-wrapper">
      <div class="container py-5 mt-n2 mt-sm-0">
        <div class="row pt-md-2 pt-lg-3 pb-sm-2 pb-md-3 pb-lg-4 pb-xl-5">

            {% include 'incs/user_pages/sidebar.html' %}

          <!-- Addresses content -->
          <div class="col-lg-9">
            <div class="ps-lg-3 ps-xl-0">

              <!-- Page title -->
              <div id="addresses-container">
                <!-- Addresses will be dynamically inserted here -->
            </div>
            
               <!-- -->
              <div class="border-bottom py-4">
                <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
                    <div class="d-flex align-items-center gap-3 me-4">
                        <h2 class="h6 mb-0">Shipping Addresses</h2>
                    </div>
                    <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed" href="#addressEdit" data-bs-toggle="collapse" aria-expanded="false" aria-controls="addressEdit">Edit</a>
                </div>
            
                <div class="collapse show" id="addressDisplay">
                    <ul class="list-unstyled fs-sm m-0" id="address-display">
                        <!-- Addresses will be dynamically inserted here -->
                    </ul>
                </div>
            
                <div class="collapse" id="addressEdit">
                    <form class="row g-3 g-sm-4 needs-validation" novalidate="">
                        <!-- Form fields for editing addresses go here -->
                        <div class="col-12">
                            <div class="d-flex gap-3 pt-2 pt-sm-0">
                                <button type="submit" class="btn btn-primary">Save changes</button>
                                <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#addressDisplay" aria-expanded="true" aria-controls="addressDisplay">Close</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!--- -->

              <div class="border-bottom py-4">
                <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
                  <div class="d-flex align-items-center gap-3 me-4">
                    <h1 class="h2 mb-1 mb-sm-2">Addresses</h1>
                    <a class="nav-link animate-underline fs-base px-0" href="#newAddressModal" data-bs-toggle="modal">
                      <i class="ci-plus fs-lg ms-n1 me-2"></i>
                      <span class="animate-target badge text-bg-info rounded-pill">Add address</span>
                    </a>
                  </div>

                  <a class="nav-link animate-underline fs-base px-0" href="#newAddressModal" data-bs-toggle="modal">
                    <i class="ci-plus fs-lg ms-n1 me-2"></i>
                    <span class="animate-target badge text-bg-info rounded-pill">Add address</span>
                  </a>
                </div>

              <!-- Primary shipping address --
              <div class="border-bottom py-4">
                <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
                  <div class="d-flex align-items-center gap-3 me-4">
                    <h2 class="h6 mb-0">Shipping address</h2>
                    <span class="badge text-bg-info rounded-pill">Primary</span>
                  </div>
                  <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed" href=".primary-address" data-bs-toggle="collapse" aria-expanded="false" aria-controls="primaryAddressPreview primaryAddressEdit">Edit</a>
                </div>
                
                <div class="collapse primary-address show" id="primaryAddressPreview">
                  <ul class="list-unstyled fs-sm m-0">
                    <li>New York 11741, USA</li>
                    <li>396 Lillian Bolavandy, Holbrook</li>
                  </ul>
                </div>
                <div class="collapse primary-address" id="primaryAddressEdit">
                  <form class="row g-3 g-sm-4 needs-validation" novalidate="">
                    <div class="col-sm-6">
                      <div class="position-relative">
                        <label class="form-label">Country</label>
                        <div class="choices" data-type="select-one" tabindex="0" role="combobox" aria-autocomplete="list" aria-haspopup="true" aria-expanded="false"><div class="form-select"><select class="form-select choices__input" data-select="{&quot;searchEnabled&quot;: true}" aria-label="Select country" required="" hidden="" tabindex="-1" data-choice="active">
                          <option value="">Select country...</option>
                          <optgroup label="Africa">
                            <option value="Nigeria">Nigeria</option>
                            <option value="South Africa">South Africa</option>
                            <option value="Kenya">Kenya</option>
                            <option value="Egypt">Egypt</option>
                            <option value="Ethiopia">Ethiopia</option>
                          </optgroup>
                          <optgroup label="Asia">
                            <option value="China">China</option>
                            <option value="India">India</option>
                            <option value="Japan">Japan</option>
                            <option value="South Korea">South Korea</option>
                            <option value="Saudi Arabia">Saudi Arabia</option>
                          </optgroup>
                          <optgroup label="Europe">
                            <option value="Germany">Germany</option>
                            <option value="France">France</option>
                            <option value="United Kingdom">United Kingdom</option>
                            <option value="Italy">Italy</option>
                            <option value="Spain">Spain</option>
                          </optgroup>
                          <optgroup label="North America">
                            <option value="United States" selected="">United States</option>
                            <option value="Canada">Canada</option>
                            <option value="Mexico">Mexico</option>
                            <option value="Jamaica">Jamaica</option>
                            <option value="Costa Rica">Costa Rica</option>
                          </optgroup>
                          <optgroup label="South America">
                            <option value="Brazil">Brazil</option>
                            <option value="Argentina">Argentina</option>
                            <option value="Colombia">Colombia</option>
                            <option value="Chile">Chile</option>
                            <option value="Peru">Peru</option>
                          </optgroup>
                          <optgroup label="Oceania">
                            <option value="Australia">Australia</option>
                            <option value="New Zealand">New Zealand</option>
                            <option value="Papua New Guinea">Papua New Guinea</option>
                            <option value="Fiji">Fiji</option>
                            <option value="Solomon Islands">Solomon Islands</option>
                          </optgroup>
                        </select><div class="choices__list choices__list--single" role="listbox"><div class="choices__item choices__item--selectable" data-item="" data-id="17" data-value="United States" aria-selected="true" role="option" data-deletable="">United States<button type="button" class="choices__button" aria-label="Remove item: United States" data-button="">Remove item</button></div></div></div><div class="choices__list choices__list--dropdown" aria-expanded="false"><input type="search" class="choices__input choices__input--cloned" autocomplete="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" aria-label="Select country..." placeholder="Search..."><div class="choices__list" role="listbox"><div id="choices--aa8e-item-choice-1" class="choices__item choices__item--choice choices__placeholder choices__item--selectable is-highlighted" role="option" data-choice="" data-id="1" data-value="" data-choice-selectable="" aria-selected="true">Select country...</div><div class="choices__group" role="group" data-group="" data-id="1" data-value="Africa"><div class="choices__heading">Africa</div></div><div id="choices--aa8e-item-choice-2" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="2" data-value="Nigeria" data-group-id="1" data-choice-selectable="">Nigeria</div><div id="choices--aa8e-item-choice-3" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="3" data-value="South Africa" data-group-id="1" data-choice-selectable="">South Africa</div><div id="choices--aa8e-item-choice-4" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="4" data-value="Kenya" data-group-id="1" data-choice-selectable="">Kenya</div><div id="choices--aa8e-item-choice-5" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="5" data-value="Egypt" data-group-id="1" data-choice-selectable="">Egypt</div><div id="choices--aa8e-item-choice-6" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="6" data-value="Ethiopia" data-group-id="1" data-choice-selectable="">Ethiopia</div><div class="choices__group" role="group" data-group="" data-id="2" data-value="Asia"><div class="choices__heading">Asia</div></div><div id="choices--aa8e-item-choice-7" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="7" data-value="China" data-group-id="2" data-choice-selectable="">China</div><div id="choices--aa8e-item-choice-8" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="8" data-value="India" data-group-id="2" data-choice-selectable="">India</div><div id="choices--aa8e-item-choice-9" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="9" data-value="Japan" data-group-id="2" data-choice-selectable="">Japan</div><div id="choices--aa8e-item-choice-10" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="10" data-value="South Korea" data-group-id="2" data-choice-selectable="">South Korea</div><div id="choices--aa8e-item-choice-11" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="11" data-value="Saudi Arabia" data-group-id="2" data-choice-selectable="">Saudi Arabia</div><div class="choices__group" role="group" data-group="" data-id="3" data-value="Europe"><div class="choices__heading">Europe</div></div><div id="choices--aa8e-item-choice-12" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="12" data-value="Germany" data-group-id="3" data-choice-selectable="">Germany</div><div id="choices--aa8e-item-choice-13" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="13" data-value="France" data-group-id="3" data-choice-selectable="">France</div><div id="choices--aa8e-item-choice-14" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="14" data-value="United Kingdom" data-group-id="3" data-choice-selectable="">United Kingdom</div><div id="choices--aa8e-item-choice-15" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="15" data-value="Italy" data-group-id="3" data-choice-selectable="">Italy</div><div id="choices--aa8e-item-choice-16" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="16" data-value="Spain" data-group-id="3" data-choice-selectable="">Spain</div><div class="choices__group" role="group" data-group="" data-id="4" data-value="North America"><div class="choices__heading">North America</div></div><div id="choices--aa8e-item-choice-17" class="choices__item choices__item--choice is-selected choices__item--selectable" role="treeitem" data-choice="" data-id="17" data-value="United States" data-group-id="4" data-choice-selectable="">United States</div><div id="choices--aa8e-item-choice-18" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="18" data-value="Canada" data-group-id="4" data-choice-selectable="">Canada</div><div id="choices--aa8e-item-choice-19" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="19" data-value="Mexico" data-group-id="4" data-choice-selectable="">Mexico</div><div id="choices--aa8e-item-choice-20" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="20" data-value="Jamaica" data-group-id="4" data-choice-selectable="">Jamaica</div><div id="choices--aa8e-item-choice-21" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="21" data-value="Costa Rica" data-group-id="4" data-choice-selectable="">Costa Rica</div><div class="choices__group" role="group" data-group="" data-id="5" data-value="South America"><div class="choices__heading">South America</div></div><div id="choices--aa8e-item-choice-22" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="22" data-value="Brazil" data-group-id="5" data-choice-selectable="">Brazil</div><div id="choices--aa8e-item-choice-23" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="23" data-value="Argentina" data-group-id="5" data-choice-selectable="">Argentina</div><div id="choices--aa8e-item-choice-24" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="24" data-value="Colombia" data-group-id="5" data-choice-selectable="">Colombia</div><div id="choices--aa8e-item-choice-25" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="25" data-value="Chile" data-group-id="5" data-choice-selectable="">Chile</div><div id="choices--aa8e-item-choice-26" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="26" data-value="Peru" data-group-id="5" data-choice-selectable="">Peru</div><div class="choices__group" role="group" data-group="" data-id="6" data-value="Oceania"><div class="choices__heading">Oceania</div></div><div id="choices--aa8e-item-choice-27" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="27" data-value="Australia" data-group-id="6" data-choice-selectable="">Australia</div><div id="choices--aa8e-item-choice-28" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="28" data-value="New Zealand" data-group-id="6" data-choice-selectable="">New Zealand</div><div id="choices--aa8e-item-choice-29" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="29" data-value="Papua New Guinea" data-group-id="6" data-choice-selectable="">Papua New Guinea</div><div id="choices--aa8e-item-choice-30" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="30" data-value="Fiji" data-group-id="6" data-choice-selectable="">Fiji</div><div id="choices--aa8e-item-choice-31" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="31" data-value="Solomon Islands" data-group-id="6" data-choice-selectable="">Solomon Islands</div></div></div></div>
                        <div class="invalid-feedback">Please select your country!</div>
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="position-relative">
                        <label class="form-label">City</label>
                        <div class="choices" data-type="select-one" tabindex="0" role="combobox" aria-autocomplete="list" aria-haspopup="true" aria-expanded="false"><div class="form-select"><select class="form-select choices__input" data-select="{&quot;searchEnabled&quot;: true}" aria-label="Select city" required="" hidden="" tabindex="-1" data-choice="active">
                          <option value="">Select city...</option>
                          <option value="Austin">Austin</option>
                          <option value="Charlotte">Charlotte</option>
                          <option value="Chicago">Chicago</option>
                          <option value="Columbus">Columbus</option>
                          <option value="Dallas">Dallas</option>
                          <option value="Houston">Houston</option>
                          <option value="Jacksonville">Jacksonville</option>
                          <option value="Los Angeles">Los Angeles</option>
                          <option value="New York" selected="">New York</option>
                          <option value="Orlando">Orlando</option>
                          <option value="Philadelphia">Philadelphia</option>
                          <option value="Phoenix">Phoenix</option>
                          <option value="San Antonio">San Antonio</option>
                          <option value="San Diego">San Diego</option>
                          <option value="San Jose">San Jose</option>
                        </select><div class="choices__list choices__list--single" role="listbox"><div class="choices__item choices__item--selectable" data-item="" data-id="10" data-value="New York" aria-selected="true" role="option" data-deletable="">New York<button type="button" class="choices__button" aria-label="Remove item: New York" data-button="">Remove item</button></div></div></div><div class="choices__list choices__list--dropdown" aria-expanded="false"><input type="search" class="choices__input choices__input--cloned" autocomplete="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" aria-label="Select city..." placeholder="Search..."><div class="choices__list" role="listbox"><div id="choices--v2ys-item-choice-1" class="choices__item choices__item--choice choices__placeholder choices__item--selectable is-highlighted" role="option" data-choice="" data-id="1" data-value="" data-choice-selectable="" aria-selected="true">Select city...</div><div id="choices--v2ys-item-choice-2" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="2" data-value="Austin" data-choice-selectable="">Austin</div><div id="choices--v2ys-item-choice-3" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="3" data-value="Charlotte" data-choice-selectable="">Charlotte</div><div id="choices--v2ys-item-choice-4" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="4" data-value="Chicago" data-choice-selectable="">Chicago</div><div id="choices--v2ys-item-choice-5" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="5" data-value="Columbus" data-choice-selectable="">Columbus</div><div id="choices--v2ys-item-choice-6" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="6" data-value="Dallas" data-choice-selectable="">Dallas</div><div id="choices--v2ys-item-choice-7" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="7" data-value="Houston" data-choice-selectable="">Houston</div><div id="choices--v2ys-item-choice-8" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="8" data-value="Jacksonville" data-choice-selectable="">Jacksonville</div><div id="choices--v2ys-item-choice-9" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="9" data-value="Los Angeles" data-choice-selectable="">Los Angeles</div><div id="choices--v2ys-item-choice-10" class="choices__item choices__item--choice is-selected choices__item--selectable" role="option" data-choice="" data-id="10" data-value="New York" data-choice-selectable="">New York</div><div id="choices--v2ys-item-choice-11" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="11" data-value="Orlando" data-choice-selectable="">Orlando</div><div id="choices--v2ys-item-choice-12" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="12" data-value="Philadelphia" data-choice-selectable="">Philadelphia</div><div id="choices--v2ys-item-choice-13" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="13" data-value="Phoenix" data-choice-selectable="">Phoenix</div><div id="choices--v2ys-item-choice-14" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="14" data-value="San Antonio" data-choice-selectable="">San Antonio</div><div id="choices--v2ys-item-choice-15" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="15" data-value="San Diego" data-choice-selectable="">San Diego</div><div id="choices--v2ys-item-choice-16" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="16" data-value="San Jose" data-choice-selectable="">San Jose</div></div></div></div>
                        <div class="invalid-feedback">Please select your city!</div>
                      </div>
                    </div>
                    <div class="col-sm-4">
                      <div class="position-relative">
                        <label for="psa-zip" class="form-label">ZIP code</label>
                        <input type="text" class="form-control" id="psa-zip" value="11741" required="">
                        <div class="invalid-feedback">Please enter your ZIP code!</div>
                      </div>
                    </div>
                    <div class="col-sm-8">
                      <div class="position-relative">
                        <label for="psa-address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="psa-address" value="396 Lillian Bolavandy, Holbrook" required="">
                        <div class="invalid-feedback">Please enter your address!</div>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="form-check mb-0">
                        <input type="checkbox" class="form-check-input" id="set-primary-1" checked="">
                        <label for="set-primary-1" class="form-check-label">Set as primary address</label>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="d-flex gap-3 pt-2 pt-sm-0">
                        <button type="submit" class="btn btn-primary">Save changes</button>
                        <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target=".primary-address" aria-expanded="true" aria-controls="primaryAddressPreview primaryAddressEdit">Close</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div> -->
              <!-- Primary shipping address -->
<div class="border-bottom py-4">
  <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
      <div class="d-flex align-items-center gap-3 me-4">
          <h2 class="h6 mb-0">Shipping address</h2>
          <span class="badge text-bg-info rounded-pill">Primary</span>
      </div>
      <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed" href=".primary-address" data-bs-toggle="collapse" aria-expanded="false" aria-controls="primaryAddressPreview primaryAddressEdit">Edit</a>
  </div>

  <div class="collapse primary-address show" id="primaryAddressPreview">

      <div class="collapse primary-address show" id="primaryAddressPreview">
        <ul class="list-unstyled fs-sm m-0" id="address-display">
          <!-- Address will be displayed here -->
          <!--<li>New York 11741, USA</li>
          <li>396 Lillian Bolavandy, Holbrook</li>-->
        </ul>
      </div>
  </div>

  <div class="collapse primary-address" id="primaryAddressEdit">
      <form id="address-form" class="row g-3 g-sm-4 needs-validation" novalidate="">
          <div class="col-sm-6">
              <div class="position-relative">
                  <label class="form-label">Country 02</label>
                  <select class="form-select" id="country" required>
                      <option value="">Select country...</option>
                      <option value="United States" selected>United States</option>
                      <!-- Add other countries here -->
                  </select>
                  <div class="invalid-feedback">Please select your country!</div>
              </div>
          </div>
          <div class="col-sm-6">
              <div class="position-relative">
                  <label class="form-label">City</label>
                  <select class="form-select" id="city" required>
                      <option value="">Select city...</option>
                      <option value="New York" selected>New York</option>
                      <!-- Add other cities here -->
                  </select>
                  <div class="invalid-feedback">Please select your city!</div>
              </div>
          </div>
          <div class="col-sm-4">
              <div class="position-relative">
                  <label for="zip" class="form-label">ZIP code</label>
                  <input type="text" class="form-control" id="zip" required>
                  <div class="invalid-feedback">Please enter your ZIP code!</div>
              </div>
          </div>
          <div class="col-sm-8">
              <div class="position-relative">
                  <label for="address" class="form-label">Address</label>
                  <input type="text" class="form-control" id="address" required>
                  <div class="invalid-feedback">Please enter your address!</div>
              </div>
          </div>
          <div class="col-12">
              <div class="d-flex gap-3 pt-2 pt-sm-0">
                  <button type="submit" class="btn btn-primary">Save changes</button>
                  <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target=".primary-address" aria-expanded="true" aria-controls="primaryAddressPreview primaryAddressEdit">Close</button>
              </div>
          </div>
      </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const addressForm = document.getElementById('address-form');

    // Fetch existing address data on page load
    fetchAddresses();

    // Handle form submission
    addressForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        
        const addressData = {
            country: document.getElementById('country').value,
            city: document.getElementById('city').value,
            zip_code: document.getElementById('zip').value,
            address: document.getElementById('address').value,
        };

        try {
            const response = await fetch(`${window.apiUrl}/addresses`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}` // Include JWT token
                },
                body: JSON.stringify(addressData),
            });

            if (response.ok) {
                const result = await response.json();
                window.response_modal(result.message);
                fetchAddresses(); // Refresh displayed addresses
            } else {
                const errorData = await response.json();
                //alert(`Error: ${errorData.message}`);
                window.response_modal(errorData.message);
            }
        } catch (error) {
            console.error('Error submitting address:', error);
            window.response_modal('An error occurred while saving the address.');
        }
    });
});

// Function to fetch and display addresses
async function fetchAddresses() {
    try {
        const response = await window.make_request(`${window.apiUrl}/addresses`, {
            method: 'GET',
            headers: {
                //'Authorization': `Bearer ${localStorage.getItem('access_token')}` // Include JWT token
            }
        });

        if (response.success) {
            const data = await response;
            const addresses = data.addresses; // Adjust according to your API response structure
            displayAddresses(addresses);
            window.response_modal(data.message);
        } else {
            window.response_modal(`${response.error}`);
            console.error('Failed to fetch addresses');
        }
    } catch (error) {
        window.response_modal(`Error fetching addresses:', ${error}`);
        console.error(`Error fetching addresses: ${error}`);
    }
}

// Function to display addresses
function displayAddresses(addresses) {
  const addressesContainer = document.getElementById('addresses-container');
  addressesContainer.innerHTML = ''; // Clear existing addresses

  addresses.forEach((address, index) => {
      const addressDiv = document.createElement('div');
      addressDiv.classList.add('border-bottom', 'py-4');

      addressDiv.innerHTML = `
          <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
              <div class="d-flex align-items-center gap-3 me-4">
                  <h2 class="h6 mb-0">Shipping Address ${index + 1}</h2>
              </div>
              <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed" href="#addressEdit${index}" data-bs-toggle="collapse" aria-expanded="false" aria-controls="addressPreview${index} addressEdit${index}">Edit</a>
          </div>
          <div class="collapse show" id="addressPreview${index}">
              <ul class="list-unstyled fs-sm m-0">
                  <li>${address.street_address || 'No street address provided'}, ${address.city}, ${address.state}, ${address.zip_code || 'No ZIP code'}, ${address.country}</li>
              </ul>
          </div>
          <div class="collapse" id="addressEdit${index}">
              <form class="row g-3 g-sm-4 needs-validation" novalidate="">
                  <div class="col-sm-6">
                      <div class="position-relative">
                          <label class="form-label">Country</label>
                          <input type="text" class="form-control" value="${address.country}" required="">
                          <div class="invalid-feedback">Please enter your country!</div>
                      </div>
                  </div>
                  <div class="col-sm-6">
                      <div class="position-relative">
                          <label class="form-label">City</label>
                          <input type="text" class="form-control" value="${address.city}" required="">
                          <div class="invalid-feedback">Please enter your city!</div>
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <div class="position-relative">
                          <label for="zip-${index}" class="form-label">ZIP code</label>
                          <input type="text" class="form-control" id="zip-${index}" value="${address.zip_code}" required="">
                          <div class="invalid-feedback">Please enter your ZIP code!</div>
                      </div>
                  </div>
                  <div class="col-sm-8">
                      <div class="position-relative">
                          <label for="address-${index}" class="form-label">Address</label>
                          <input type="text" class="form-control" id="address-${index}" value="${address.street_address}" required="">
                          <div class="invalid-feedback">Please enter your address!</div>
                      </div>
                  </div>
                  <div class="col-12">
                      <div class="d-flex gap-3 pt-2 pt-sm-0">
                          <button type="submit" class="btn btn-primary">Save changes</button>
                          <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#addressEdit${index}" aria-expanded="true" aria-controls="addressPreview${index} addressEdit${index}">Close</button>
                      </div>
                  </div>
              </form>
          </div>
      `;

      addressesContainer.appendChild(addressDiv);
  });
}


// Call the function with the fetched addresses
//displayAddresses(addresses);

</script>

              <!-- Alternative shipping address -->
              <div class="border-bottom py-4">
                <div class="nav flex-nowrap align-items-center justify-content-between pb-1 mb-3">
                  <div class="d-flex align-items-center gap-3 me-4">
                    <h2 class="h6 mb-0">Alternative shipping address</h2>
                  </div>
                  <a class="nav-link hiding-collapse-toggle text-decoration-underline p-0 collapsed" href=".alternative-address" data-bs-toggle="collapse" aria-expanded="false" aria-controls="alternativeAddressPreview alternativeAddressEdit">Edit</a>
                </div>
                <div class="collapse alternative-address show" id="alternativeAddressPreview">
                  <ul class="list-unstyled fs-sm m-0">
                    <li>Florida 32806, USA</li>
                    <li>514 S. Magnolia St., Orlando</li>
                  </ul>
                </div>
                <div class="collapse alternative-address" id="alternativeAddressEdit">
                  <form class="row g-3 g-sm-4 needs-validation" novalidate="">
                    <div class="col-sm-6">
                      <div class="position-relative">
                        <label class="form-label">Country</label>
                        <div class="choices" data-type="select-one" tabindex="0" role="combobox" aria-autocomplete="list" aria-haspopup="true" aria-expanded="false"><div class="form-select"><select class="form-select choices__input" data-select="{&quot;searchEnabled&quot;: true}" aria-label="Select country" required="" hidden="" tabindex="-1" data-choice="active">
                          <option value="">Select country...</option>
                          <optgroup label="Africa">
                            <option value="Nigeria">Nigeria</option>
                            <option value="South Africa">South Africa</option>
                            <option value="Kenya">Kenya</option>
                            <option value="Egypt">Egypt</option>
                            <option value="Ethiopia">Ethiopia</option>
                          </optgroup>
                          <optgroup label="Asia">
                            <option value="China">China</option>
                            <option value="India">India</option>
                            <option value="Japan">Japan</option>
                            <option value="South Korea">South Korea</option>
                            <option value="Saudi Arabia">Saudi Arabia</option>
                          </optgroup>
                          <optgroup label="Europe">
                            <option value="Germany">Germany</option>
                            <option value="France">France</option>
                            <option value="United Kingdom">United Kingdom</option>
                            <option value="Italy">Italy</option>
                            <option value="Spain">Spain</option>
                          </optgroup>
                          <optgroup label="North America">
                            <option value="United States" selected="">United States</option>
                            <option value="Canada">Canada</option>
                            <option value="Mexico">Mexico</option>
                            <option value="Jamaica">Jamaica</option>
                            <option value="Costa Rica">Costa Rica</option>
                          </optgroup>
                          <optgroup label="South America">
                            <option value="Brazil">Brazil</option>
                            <option value="Argentina">Argentina</option>
                            <option value="Colombia">Colombia</option>
                            <option value="Chile">Chile</option>
                            <option value="Peru">Peru</option>
                          </optgroup>
                          <optgroup label="Oceania">
                            <option value="Australia">Australia</option>
                            <option value="New Zealand">New Zealand</option>
                            <option value="Papua New Guinea">Papua New Guinea</option>
                            <option value="Fiji">Fiji</option>
                            <option value="Solomon Islands">Solomon Islands</option>
                          </optgroup>
                        </select><div class="choices__list choices__list--single" role="listbox"><div class="choices__item choices__item--selectable" data-item="" data-id="17" data-value="United States" aria-selected="true" role="option" data-deletable="">United States<button type="button" class="choices__button" aria-label="Remove item: United States" data-button="">Remove item</button></div></div></div><div class="choices__list choices__list--dropdown" aria-expanded="false"><input type="search" class="choices__input choices__input--cloned" autocomplete="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" aria-label="Select country..." placeholder="Search..."><div class="choices__list" role="listbox"><div id="choices--ap1n-item-choice-1" class="choices__item choices__item--choice choices__placeholder choices__item--selectable is-highlighted" role="option" data-choice="" data-id="1" data-value="" data-choice-selectable="" aria-selected="true">Select country...</div><div class="choices__group" role="group" data-group="" data-id="1" data-value="Africa"><div class="choices__heading">Africa</div></div><div id="choices--ap1n-item-choice-2" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="2" data-value="Nigeria" data-group-id="1" data-choice-selectable="">Nigeria</div><div id="choices--ap1n-item-choice-3" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="3" data-value="South Africa" data-group-id="1" data-choice-selectable="">South Africa</div><div id="choices--ap1n-item-choice-4" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="4" data-value="Kenya" data-group-id="1" data-choice-selectable="">Kenya</div><div id="choices--ap1n-item-choice-5" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="5" data-value="Egypt" data-group-id="1" data-choice-selectable="">Egypt</div><div id="choices--ap1n-item-choice-6" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="6" data-value="Ethiopia" data-group-id="1" data-choice-selectable="">Ethiopia</div><div class="choices__group" role="group" data-group="" data-id="2" data-value="Asia"><div class="choices__heading">Asia</div></div><div id="choices--ap1n-item-choice-7" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="7" data-value="China" data-group-id="2" data-choice-selectable="">China</div><div id="choices--ap1n-item-choice-8" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="8" data-value="India" data-group-id="2" data-choice-selectable="">India</div><div id="choices--ap1n-item-choice-9" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="9" data-value="Japan" data-group-id="2" data-choice-selectable="">Japan</div><div id="choices--ap1n-item-choice-10" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="10" data-value="South Korea" data-group-id="2" data-choice-selectable="">South Korea</div><div id="choices--ap1n-item-choice-11" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="11" data-value="Saudi Arabia" data-group-id="2" data-choice-selectable="">Saudi Arabia</div><div class="choices__group" role="group" data-group="" data-id="3" data-value="Europe"><div class="choices__heading">Europe</div></div><div id="choices--ap1n-item-choice-12" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="12" data-value="Germany" data-group-id="3" data-choice-selectable="">Germany</div><div id="choices--ap1n-item-choice-13" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="13" data-value="France" data-group-id="3" data-choice-selectable="">France</div><div id="choices--ap1n-item-choice-14" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="14" data-value="United Kingdom" data-group-id="3" data-choice-selectable="">United Kingdom</div><div id="choices--ap1n-item-choice-15" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="15" data-value="Italy" data-group-id="3" data-choice-selectable="">Italy</div><div id="choices--ap1n-item-choice-16" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="16" data-value="Spain" data-group-id="3" data-choice-selectable="">Spain</div><div class="choices__group" role="group" data-group="" data-id="4" data-value="North America"><div class="choices__heading">North America</div></div><div id="choices--ap1n-item-choice-17" class="choices__item choices__item--choice is-selected choices__item--selectable" role="treeitem" data-choice="" data-id="17" data-value="United States" data-group-id="4" data-choice-selectable="">United States</div><div id="choices--ap1n-item-choice-18" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="18" data-value="Canada" data-group-id="4" data-choice-selectable="">Canada</div><div id="choices--ap1n-item-choice-19" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="19" data-value="Mexico" data-group-id="4" data-choice-selectable="">Mexico</div><div id="choices--ap1n-item-choice-20" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="20" data-value="Jamaica" data-group-id="4" data-choice-selectable="">Jamaica</div><div id="choices--ap1n-item-choice-21" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="21" data-value="Costa Rica" data-group-id="4" data-choice-selectable="">Costa Rica</div><div class="choices__group" role="group" data-group="" data-id="5" data-value="South America"><div class="choices__heading">South America</div></div><div id="choices--ap1n-item-choice-22" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="22" data-value="Brazil" data-group-id="5" data-choice-selectable="">Brazil</div><div id="choices--ap1n-item-choice-23" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="23" data-value="Argentina" data-group-id="5" data-choice-selectable="">Argentina</div><div id="choices--ap1n-item-choice-24" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="24" data-value="Colombia" data-group-id="5" data-choice-selectable="">Colombia</div><div id="choices--ap1n-item-choice-25" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="25" data-value="Chile" data-group-id="5" data-choice-selectable="">Chile</div><div id="choices--ap1n-item-choice-26" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="26" data-value="Peru" data-group-id="5" data-choice-selectable="">Peru</div><div class="choices__group" role="group" data-group="" data-id="6" data-value="Oceania"><div class="choices__heading">Oceania</div></div><div id="choices--ap1n-item-choice-27" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="27" data-value="Australia" data-group-id="6" data-choice-selectable="">Australia</div><div id="choices--ap1n-item-choice-28" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="28" data-value="New Zealand" data-group-id="6" data-choice-selectable="">New Zealand</div><div id="choices--ap1n-item-choice-29" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="29" data-value="Papua New Guinea" data-group-id="6" data-choice-selectable="">Papua New Guinea</div><div id="choices--ap1n-item-choice-30" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="30" data-value="Fiji" data-group-id="6" data-choice-selectable="">Fiji</div><div id="choices--ap1n-item-choice-31" class="choices__item choices__item--choice choices__item--selectable" role="treeitem" data-choice="" data-id="31" data-value="Solomon Islands" data-group-id="6" data-choice-selectable="">Solomon Islands</div></div></div></div>
                        <div class="invalid-feedback">Please select your country!</div>
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="position-relative">
                        <label class="form-label">City</label>
                        <div class="choices" data-type="select-one" tabindex="0" role="combobox" aria-autocomplete="list" aria-haspopup="true" aria-expanded="false"><div class="form-select"><select class="form-select choices__input" data-select="{&quot;searchEnabled&quot;: true}" aria-label="Select city" required="" hidden="" tabindex="-1" data-choice="active">
                          <option value="">Select city...</option>
                          <option value="Austin">Austin</option>
                          <option value="Charlotte">Charlotte</option>
                          <option value="Chicago">Chicago</option>
                          <option value="Columbus">Columbus</option>
                          <option value="Dallas">Dallas</option>
                          <option value="Houston">Houston</option>
                          <option value="Jacksonville">Jacksonville</option>
                          <option value="Los Angeles">Los Angeles</option>
                          <option value="New York">New York</option>
                          <option value="Orlando" selected="">Orlando</option>
                          <option value="Philadelphia">Philadelphia</option>
                          <option value="Phoenix">Phoenix</option>
                          <option value="San Antonio">San Antonio</option>
                          <option value="San Diego">San Diego</option>
                          <option value="San Jose">San Jose</option>
                        </select><div class="choices__list choices__list--single" role="listbox"><div class="choices__item choices__item--selectable" data-item="" data-id="11" data-value="Orlando" aria-selected="true" role="option" data-deletable="">Orlando<button type="button" class="choices__button" aria-label="Remove item: Orlando" data-button="">Remove item</button></div></div></div><div class="choices__list choices__list--dropdown" aria-expanded="false"><input type="search" class="choices__input choices__input--cloned" autocomplete="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" aria-label="Select city..." placeholder="Search..."><div class="choices__list" role="listbox"><div id="choices--5wkc-item-choice-1" class="choices__item choices__item--choice choices__placeholder choices__item--selectable is-highlighted" role="option" data-choice="" data-id="1" data-value="" data-choice-selectable="" aria-selected="true">Select city...</div><div id="choices--5wkc-item-choice-2" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="2" data-value="Austin" data-choice-selectable="">Austin</div><div id="choices--5wkc-item-choice-3" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="3" data-value="Charlotte" data-choice-selectable="">Charlotte</div><div id="choices--5wkc-item-choice-4" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="4" data-value="Chicago" data-choice-selectable="">Chicago</div><div id="choices--5wkc-item-choice-5" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="5" data-value="Columbus" data-choice-selectable="">Columbus</div><div id="choices--5wkc-item-choice-6" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="6" data-value="Dallas" data-choice-selectable="">Dallas</div><div id="choices--5wkc-item-choice-7" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="7" data-value="Houston" data-choice-selectable="">Houston</div><div id="choices--5wkc-item-choice-8" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="8" data-value="Jacksonville" data-choice-selectable="">Jacksonville</div><div id="choices--5wkc-item-choice-9" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="9" data-value="Los Angeles" data-choice-selectable="">Los Angeles</div><div id="choices--5wkc-item-choice-10" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="10" data-value="New York" data-choice-selectable="">New York</div><div id="choices--5wkc-item-choice-11" class="choices__item choices__item--choice is-selected choices__item--selectable" role="option" data-choice="" data-id="11" data-value="Orlando" data-choice-selectable="">Orlando</div><div id="choices--5wkc-item-choice-12" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="12" data-value="Philadelphia" data-choice-selectable="">Philadelphia</div><div id="choices--5wkc-item-choice-13" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="13" data-value="Phoenix" data-choice-selectable="">Phoenix</div><div id="choices--5wkc-item-choice-14" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="14" data-value="San Antonio" data-choice-selectable="">San Antonio</div><div id="choices--5wkc-item-choice-15" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="15" data-value="San Diego" data-choice-selectable="">San Diego</div><div id="choices--5wkc-item-choice-16" class="choices__item choices__item--choice choices__item--selectable" role="option" data-choice="" data-id="16" data-value="San Jose" data-choice-selectable="">San Jose</div></div></div></div>
                        <div class="invalid-feedback">Please select your city!</div>
                      </div>
                    </div>
                    <div class="col-sm-4">
                      <div class="position-relative">
                        <label for="asa-zip" class="form-label">ZIP code</label>
                        <input type="text" class="form-control" id="asa-zip" value="32806" required="">
                        <div class="invalid-feedback">Please enter your ZIP code!</div>
                      </div>
                    </div>
                    <div class="col-sm-8">
                      <div class="position-relative">
                        <label for="asa-address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="asa-address" value="514 S. Magnolia St." required="">
                        <div class="invalid-feedback">Please enter your address!</div>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="form-check mb-0">
                        <input type="checkbox" class="form-check-input" id="set-primary-2">
                        <label for="set-primary-2" class="form-check-label">Set as primary address</label>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="d-flex gap-3 pt-2 pt-sm-0">
                        <button type="submit" class="btn btn-primary">Save changes</button>
                        <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target=".alternative-address" aria-expanded="true" aria-controls="alternativeAddressPreview alternativeAddressEdit">Close</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </main>
  {% endblock content %}