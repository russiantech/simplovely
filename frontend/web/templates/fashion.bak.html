<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Products Gallery</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .gallery-thumbnails {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            overflow-x: auto;
            padding-bottom: 8px;
        }
        .gallery-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .gallery-thumbnail:hover, .gallery-thumbnail.active {
            opacity: 1;
        }
        .gallery-main-image {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .gallery-main-image:hover {
            transform: scale(1.02);
        }
        .modal-gallery {
            z-index: 1060; /* Higher than default bootstrap modals */
        }
        .modal-gallery .carousel-item {
            text-align: center;
            background-color: #000;
        }
        .modal-gallery .carousel-item img {
            max-height: 70vh;
            width: auto;
            max-width: 100%;
            margin: 0 auto;
        }
        .image-counter {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Your existing popular categories section -->
    <section class="container py-2 py-sm-3 py-md-4 py-lg-5 my-xxl-3">
        <div class="d-md-flex align-items-start gap-5 pb-2 pb-sm-3">
            <h2 class="text-nowrap mb-4 mb-md-0">Popular Categories:</h2>
            <div class="d-flex min-w-0 flex-fill gap-4">
                <div class="overflow-x-auto pb-3">
                    <ul class="nav nav-pills flex-nowrap gap-2 text-nowrap" role="tablist">
                        <li class="nav-item me-1">
                            <a class="nav-link text-nowrap cursor-pointer active" id="all-categories-tab" data-bs-toggle="pill" data-bs-target="#all-categories" role="tab" aria-controls="all-categories" aria-selected="true">
                                All
                            </a>
                        </li>
                        <li class="nav-item me-1">
                            <a class="nav-link text-nowrap cursor-pointer" id="women-categories-tab" data-bs-toggle="pill" data-bs-target="#women-categories" role="tab" aria-controls="women-categories" aria-selected="false">
                                Women
                            </a>
                        </li>
                        <li class="nav-item me-1">
                            <a class="nav-link text-nowrap cursor-pointer" id="men-categories-tab" data-bs-toggle="pill" data-bs-target="#men-categories" role="tab" aria-controls="men-categories" aria-selected="false">
                                Men
                            </a>
                        </li>
                        <li class="nav-item me-1">
                            <a class="nav-link text-nowrap cursor-pointer" id="children-categories-tab" data-bs-toggle="pill" data-bs-target="#children-categories" role="tab" aria-controls="children-categories" aria-selected="false">
                                Children
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="nav ms-auto mb-3 nav-item me-1">
                    <a class="nav-link position-relative fs-base text-nowrap py-1 px-0 disabled" href="listings-events.html">
                        <span class="hover-effect-underline stretched-link me-1">More..</span>
                        <i class="fi-chevron-right fs-lg"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="tab-content">
            <!-- All Categories tab -->
            <div class="tab-pane fade active show" id="all-categories" role="tabpanel" aria-labelledby="all-categories-tab">
                <div class="row row-cols-1 row-cols-lg-2 g-4 pb-5" id="all-categories-content">
                    <!-- Content will be loaded dynamically -->
                </div>
            </div>

            <!-- Other category tabs -->
            <div class="tab-pane fade" id="women-categories" role="tabpanel" aria-labelledby="women-categories-tab">
                <div class="row row-cols-1 row-cols-lg-2 g-4 pb-5" id="women-categories-content">
                    <!-- Content will be loaded dynamically -->
                </div>
            </div>

            <div class="tab-pane fade" id="men-categories" role="tabpanel" aria-labelledby="men-categories-tab">
                <div class="row row-cols-1 row-cols-lg-2 g-4 pb-5" id="men-categories-content">
                    <!-- Content will be loaded dynamically -->
                </div>
            </div>

            <div class="tab-pane fade" id="children-categories" role="tabpanel" aria-labelledby="children-categories-tab">
                <div class="row row-cols-1 row-cols-lg-2 g-4 pb-5" id="children-categories-content">
                    <!-- Content will be loaded dynamically -->
                </div>
            </div>
        </div>
    </section>

    <!-- Image Gallery Modal -->
    <div class="modal fade modal-gallery" id="imageGalleryModal" tabindex="-1" aria-labelledby="imageGalleryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content bg-dark">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title text-white" id="imageGalleryModalLabel">Product Images</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <div id="galleryCarousel" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner" id="carousel-inner">
                            <!-- Carousel items will be inserted here -->
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#galleryCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#galleryCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                        <div class="image-counter" id="imageCounter">1/5</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Set API base URL
        const apiURL = (
            window.location.hostname === "simplylovely.ng" ||
            window.location.hostname.endsWith(".simplylovely.ng")
        ) ? "https://api.simplylovely.ng/api" : (window.apiURL || "http://localhost:5001/api");

        class FashionProductsGallery {
            constructor() {
                this.modal = null;
                this.currentProduct = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initializeModal();
            }

            setupEventListeners() {
                // Event delegation for product image clicks
                document.addEventListener('click', (e) => {
                    // Check if a product image was clicked
                    if (e.target.closest('.product-image-container')) {
                        const container = e.target.closest('.product-image-container');
                        const productId = container.getAttribute('data-product-id');
                        this.openGallery(productId);
                    }
                    
                    // Check if a thumbnail was clicked
                    if (e.target.classList.contains('gallery-thumbnail')) {
                        const index = parseInt(e.target.getAttribute('data-index'));
                        this.showImage(index);
                    }
                });

                // Carousel events to update counter
                document.getElementById('galleryCarousel')?.addEventListener('slid.bs.carousel', (event) => {
                    this.updateImageCounter(event.to);
                });
            }

            initializeModal() {
                this.modal = new bootstrap.Modal(document.getElementById('imageGalleryModal'));
            }

            openGallery(productId) {
                // In a real implementation, you would fetch product data including all images
                // For this example, I'll use mock data
                const product = this.getProductById(productId);
                if (!product || !product.images || product.images.length === 0) return;
                
                this.currentProduct = product;
                this.renderGallery(product.images);
                this.modal.show();
            }

            getProductById(productId) {
                // This would normally fetch from your API
                // Mock data for demonstration
                const mockProducts = {
                    '1': {
                        id: '1',
                        name: 'Women Wears',
                        images: [
                            'static/img/fashion/01.jpg',
                            'static/img/fashion/02.jpg',
                            'static/img/fashion/03.jpg',
                            'static/img/fashion/04.jpg'
                        ]
                    },
                    '2': {
                        id: '2',
                        name: 'Men\'s Wears',
                        images: [
                            'static/img/fashion/02.jpg',
                            'static/img/fashion/01.jpg',
                            'static/img/fashion/04.jpg'
                        ]
                    },
                    '3': {
                        id: '3',
                        name: 'Children\'s Wears',
                        images: [
                            'static/img/fashion/03.jpg',
                            'static/img/fashion/01.jpg'
                        ]
                    },
                    '4': {
                        id: '4',
                        name: 'Aseobi - Modern Styles',
                        images: [
                            'static/img/fashion/04.jpg',
                            'static/img/fashion/02.jpg',
                            'static/img/fashion/03.jpg'
                        ]
                    }
                };
                
                return mockProducts[productId];
            }

            renderGallery(images) {
                const carouselInner = document.getElementById('carousel-inner');
                carouselInner.innerHTML = '';
                
                images.forEach((img, index) => {
                    const item = document.createElement('div');
                    item.className = `carousel-item ${index === 0 ? 'active' : ''}`;
                    item.innerHTML = `
                        <img src="${img}" class="d-block w-100" alt="Product image ${index + 1}">
                    `;
                    carouselInner.appendChild(item);
                });
                
                this.updateImageCounter(0);
            }

            updateImageCounter(currentIndex) {
                const total = this.currentProduct.images.length;
                document.getElementById('imageCounter').textContent = `${currentIndex + 1}/${total}`;
            }

            showImage(index) {
                // Programmatically show the specific image in the carousel
                const carousel = document.getElementById('galleryCarousel');
                const bsCarousel = bootstrap.Carousel.getInstance(carousel);
                bsCarousel.to(index);
            }
        }

        // Initialize the gallery when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.productGallery = new FashionProductsGallery();
            
            // For demonstration, add some sample products
            addSampleProducts();
        });

        // Function to add sample products (replace with your actual data loading)
        function addSampleProducts() {
            const sampleProducts = [
                {
                    id: '1',
                    name: 'Women Wears',
                    category: 'women',
                    rating: 4.5,
                    tags: 'ankara',
                    description: 'Beautiful women fashion wears',
                    images: [
                        'static/img/fashion/01.jpg',
                        'static/img/fashion/02.jpg',
                        'static/img/fashion/03.jpg'
                    ]
                },
                {
                    id: '2',
                    name: 'Men\'s Wears',
                    category: 'men',
                    rating: 4.3,
                    tags: 'native',
                    description: 'Stylish men\'s clothing',
                    images: [
                        'static/img/fashion/02.jpg',
                        'static/img/fashion/01.jpg'
                    ]
                },
                {
                    id: '3',
                    name: 'Children\'s Wears',
                    category: 'children',
                    rating: 4.7,
                    tags: 'native',
                    description: 'Comfortable children clothing',
                    images: [
                        'static/img/fashion/03.jpg',
                        'static/img/fashion/04.jpg'
                    ]
                },
                {
                    id: '4',
                    name: 'Aseobi - Modern Styles',
                    category: 'women',
                    rating: 4.9,
                    tags: 'native',
                    description: 'Modern fashion styles',
                    images: [
                        'static/img/fashion/04.jpg',
                        'static/img/fashion/01.jpg',
                        'static/img/fashion/02.jpg'
                    ]
                }
            ];

            sampleProducts.forEach(product => {
                const productHtml = createProductCard(product);
                // Add to appropriate category containers
                document.getElementById(`${product.category}-categories-content`).innerHTML += productHtml;
                document.getElementById('all-categories-content').innerHTML += productHtml;
            });
        }

        // Enhanced product card creation with gallery support
        function createProductCard(product) {
            const mainImage = product.images && product.images.length > 0 
                ? product.images[0] 
                : 'static/img/fashion/placeholder.jpg';
                
            const thumbnails = product.images && product.images.length > 1 
                ? product.images.slice(0, 4).map((img, index) => 
                    `<img src="${img}" class="gallery-thumbnail" data-index="${index}" alt="Thumbnail ${index + 1}">`
                ).join('') 
                : '';
                
            return `
                <div class="col">
                    <article class="card hover-effect-scale bg-transparent overflow-hidden">
                        <div class="row h-100 g-0">
                            <div class="col-sm-4 position-relative bg-body-tertiary overflow-hidden" style="min-height: 178px">
                                <div class="product-image-container position-absolute top-0 start-0 w-100 h-100" 
                                     data-product-id="${product.id}" style="cursor: pointer;">
                                    <img src="${mainImage}" 
                                         class="hover-effect-target w-100 h-100 object-fit-cover" 
                                         alt="${product.name}">
                                    ${product.images && product.images.length > 1 ? 
                                        `<div class="position-absolute bottom-0 end-0 m-1 bg-dark bg-opacity-50 rounded-circle p-1">
                                            <i class="bi bi-images text-white"></i>
                                        </div>` : ''}
                                </div>
                            </div>
                            <div class="col-sm-8 card-body d-flex flex-column align-items-start p-3 p-sm-4">
                                <h3 class="h6 mt-1 mt-sm-0 mb-2">
                                    <a class="stretched-link hover-effect-underline" href="#">
                                        ${product.name}
                                    </a>
                                </h3>
                                <div class="d-flex align-items-center gap-3 mb-4">
                                    <div class="d-flex align-items-center gap-1">
                                        <i class="fi-star-filled text-warning"></i>
                                        <span class="fs-sm text-secondary-emphasis">${product.rating}</span>
                                    </div>
                                    <div class="fs-sm text-dark-emphasis">${product.tags}</div>
                                </div>
                                ${thumbnails ? `<div class="gallery-thumbnails">${thumbnails}</div>` : ''}
                                <button type="button" class="btn btn-outline-dark position-relative z-2 mt-auto">
                                    Home Service
                                </button>
                            </div>
                        </div>
                    </article>
                </div>
            `;
        }
    </script>
</body>
</html>